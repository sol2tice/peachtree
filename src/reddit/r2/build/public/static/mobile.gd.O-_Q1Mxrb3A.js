jQuery.cookie=function(a,b,c){if(arguments.length>1&&String(b)!=="[object Object]"){c=jQuery.extend({},c);if(b===null||b===void 0)c.expires=-1;if(typeof c.expires==="number"){var e=c.expires,d=c.expires=new Date;d.setDate(d.getDate()+e)}b=String(b);return document.cookie=[encodeURIComponent(a),"=",c.raw?b:encodeURIComponent(b),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=b||{};d=c.raw?function(a){return a}:
decodeURIComponent;return(e=RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?d(e[1]):null};
(function(a,b){function c(a,b){for(var c=decodeURI(a),c=f[b?"strict":"loose"].exec(c),d={attr:{},param:{},seg:{}},e=14;e--;)d.attr[g[e]]=c[e]||"";d.param.query={};d.param.fragment={};d.attr.query.replace(j,function(a,b,c){b&&(d.param.query[b]=c)});d.attr.fragment.replace(l,function(a,b,c){b&&(d.param.fragment[b]=c)});d.seg.path=d.attr.path.replace(/^\/+|\/+$/g,"").split("/");d.seg.fragment=d.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");d.attr.base=d.attr.host?d.attr.protocol+"://"+d.attr.host+
(d.attr.port?":"+d.attr.port:""):"";return d}function e(a){a=a.tagName;if(a!==b)return d[a.toLowerCase()];return a}var d={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},g=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],h={anchor:"fragment"},f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},j=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,l=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;a.fn.url=function(b){var c="";this.length&&(c=a(this).attr(e(this[0]))||"");return a.url(c,b)};a.url=function(a,d){arguments.length===1&&a===!0&&(d=!0,a=b);a=a||window.location.toString();return{data:c(a,d||!1),attr:function(a){a=h[a]||
a;return a!==b?this.data.attr[a]:this.data.attr},param:function(a){return a!==b?this.data.param.query[a]:this.data.param.query},fparam:function(a){return a!==b?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){return a===b?this.data.seg.path:(a=a<0?this.data.seg.path.length+a:a-1,this.data.seg.path[a])},fsegment:function(a){return a===b?this.data.seg.fragment:(a=a<0?this.data.seg.fragment.length+a:a-1,this.data.seg.fragment[a])}}}})(jQuery);
(function(){var a=this,b=a.Backbone,c=[],e=c.push,d=c.slice,g=c.splice,h;h=typeof exports!=="undefined"?exports:a.Backbone={};h.VERSION="1.0.0";var f=a._;!f&&typeof require!=="undefined"&&(f=require("underscore"));h.$=a.jQuery||a.Zepto||a.ender||a.$;h.noConflict=function(){a.Backbone=b;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var j=h.Events={on:function(a,b,c){if(!o(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,
ctx:c||this});return this},once:function(a,b,c){if(!o(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e);b.apply(this,arguments)});e._callback=b;return this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,l,k,n;if(!this._events||!o(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;h=a?[a]:f.keys(this._events);j=0;for(l=h.length;j<l;j++)if(a=h[j],g=this._events[a]){this._events[a]=d=[];if(b||c){k=0;for(n=g.length;k<n;k++)e=g[k],(b&&b!==e.callback&&b!==
e.callback._callback||c&&c!==e.context)&&d.push(e)}d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=d.call(arguments,1);if(!o(this,"trigger",a,b))return this;var c=this._events[a],e=this._events.all;c&&m(c,b);e&&m(e,arguments);return this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;typeof b==="object"&&(c=this);a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},
l=/\s+/,o=function(a,b,c,d){if(!c)return!0;if(typeof c==="object"){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(l.test(c)){c=c.split(l);e=0;for(var f=c.length;e<f;e++)a[b].apply(a,[c[e]].concat(d));return!1}return!0},m=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],j=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);break;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);break;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);break;case 3:for(;++d<e;)(c=
a[d]).callback.call(c.ctx,f,g,j);break;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}};f.each({listenTo:"on",listenToOnce:"once"},function(a,b){j[b]=function(b,c,u){var d=this._listeners||(this._listeners={}),e=b._listenerId||(b._listenerId=f.uniqueId("l"));d[e]=b;typeof c==="object"&&(u=this);b[a](c,u,this);return this}});j.bind=j.on;j.unbind=j.off;f.extend(h,j);var k=h.Model=function(a,b){var c,d=a||{};b||(b={});this.cid=f.uniqueId("c");this.attributes={};f.extend(this,f.pick(b,p));b.parse&&
(d=this.parse(d,b)||{});if(c=f.result(this,"defaults"))d=f.defaults({},d,c);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)},p=["url","urlRoot","collection"];f.extend(k.prototype,j,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return this.get(a)!=
null},set:function(a,b,c){var d,e,g,j,h,l,k;if(a==null)return this;typeof a==="object"?(e=a,c=b):(e={})[a]=b;c||(c={});if(!this._validate(e,c))return!1;g=c.unset;j=c.silent;a=[];h=this._changing;this._changing=!0;if(!h)this._previousAttributes=f.clone(this.attributes),this.changed={};k=this.attributes;l=this._previousAttributes;if(this.idAttribute in e)this.id=e[this.idAttribute];for(d in e)b=e[d],f.isEqual(k[d],b)||a.push(d),f.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete k[d]:
k[d]=b;if(!j){if(a.length)this._pending=!0;b=0;for(d=a.length;b<d;b++)this.trigger("change:"+a[b],this,k[a[b]],c)}if(h)return this;if(!j)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){if(a==null)return!f.isEmpty(this.changed);return f.has(this.changed,
a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes,e;for(e in a)if(!f.isEqual(d[e],b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){if(a==null||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{};if(a.parse===void 0)a.parse=!0;var b=this,c=a.success;a.success=
function(d){if(!b.set(b.parse(d,a),a))return!1;c&&c(b,d,a);b.trigger("sync",b,d,a)};s(this,a);return this.sync("read",this,a)},save:function(a,b,c){var d,e=this.attributes;a==null||typeof a==="object"?(d=a,c=b):(d={})[a]=b;if(d&&(!c||!c.wait)&&!this.set(d,c))return!1;c=f.extend({validate:!0},c);if(!this._validate(d,c))return!1;if(d&&c.wait)this.attributes=f.extend({},e,d);if(c.parse===void 0)c.parse=!0;var g=this,j=c.success;c.success=function(a){g.attributes=e;var b=g.parse(a,c);c.wait&&(b=f.extend(d||
{},b));if(f.isObject(b)&&!g.set(b,c))return!1;j&&j(g,a,c);g.trigger("sync",g,a,c)};s(this,c);a=this.isNew()?"create":c.patch?"patch":"update";if(a==="patch")c.attrs=d;a=this.sync(a,this,c);if(d&&c.wait)this.attributes=e;return a},destroy:function(a){var a=a?f.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(e){(a.wait||b.isNew())&&d();c&&c(b,e,a);b.isNew()||b.trigger("sync",b,e,a)};if(this.isNew())return a.success(),!1;s(this,a);var e=this.sync("delete",
this,a);a.wait||d();return e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||v();if(this.isNew())return a;return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},f.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;var a=f.extend({},
this.attributes,a),c=this.validationError=this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,f.extend(b||{},{validationError:c}));return!1}});f.each(["keys","values","pairs","invert","pick","omit"],function(a){k.prototype[a]=function(){var b=d.call(arguments);b.unshift(this.attributes);return f[a].apply(f,b)}});var n=h.Collection=function(a,b){b||(b={});if(b.url)this.url=b.url;if(b.model)this.model=b.model;if(b.comparator!==void 0)this.comparator=b.comparator;this._reset();this.initialize.apply(this,
arguments);a&&this.reset(a,f.extend({silent:!0},b))},y={add:!0,remove:!0,merge:!0},z={add:!0,merge:!1,remove:!1};f.extend(n.prototype,j,{model:k,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return h.sync.apply(this,arguments)},add:function(a,b){return this.set(a,f.defaults(b||{},z))},remove:function(a,b){a=f.isArray(a)?a.slice():[a];b||(b={});var c,d,e,g;c=0;for(d=a.length;c<d;c++)if(g=this.get(a[c])){delete this._byId[g.id];delete this._byId[g.cid];
e=this.indexOf(g);this.models.splice(e,1);this.length--;if(!b.silent)b.index=e,g.trigger("remove",g,this,b);this._removeReference(g)}return this},set:function(a,b){b=f.defaults(b||{},y);b.parse&&(a=this.parse(a,b));f.isArray(a)||(a=a?[a]:[]);var c,d,j,h,k,l=b.at,o=this.comparator&&l==null&&b.sort!==!1,n=f.isString(this.comparator)?this.comparator:null,m=[],p=[],t={};c=0;for(d=a.length;c<d;c++)if(j=this._prepareModel(a[c],b))(h=this.get(j))?(b.remove&&(t[h.cid]=!0),b.merge&&(h.set(j.attributes,b),
o&&!k&&h.hasChanged(n)&&(k=!0))):b.add&&(m.push(j),j.on("all",this._onModelEvent,this),this._byId[j.cid]=j,j.id!=null&&(this._byId[j.id]=j));if(b.remove){c=0;for(d=this.length;c<d;++c)t[(j=this.models[c]).cid]||p.push(j);p.length&&this.remove(p,b)}m.length&&(o&&(k=!0),this.length+=m.length,l!=null?g.apply(this.models,[l,0].concat(m)):e.apply(this.models,m));k&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=m.length;c<d;c++)(j=m[c]).trigger("add",j,this,b);k&&this.trigger("sort",this,b);
return this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models;this._reset();this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a!=null)return this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){if(f.isEmpty(a))return b?void 0:[];return this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");
a||(a={});f.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=f.isFunction(b)?b:function(a){return a.get(b)};return f.sortedIndex(this.models,a,d,c)},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{};if(a.parse===void 0)a.parse=!0;var b=a.success,c=this;
a.success=function(d){c[a.reset?"reset":"set"](d,a);b&&b(c,d,a);c.trigger("sync",c,d,a)};s(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?f.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(e){b.wait&&c.add(a,b);d&&d(a,e,b)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,
b){if(a instanceof k){if(!a.collection)a.collection=this;return a}b||(b={});b.collection=this;var c=new this.model(a,b);if(!c._validate(a,b))return this.trigger("invalid",this,a,b),!1;return c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){(a==="add"||a==="remove")&&c!==this||(a==="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],b.id!=null&&(this._byId[b.id]=
b)),this.trigger.apply(this,arguments))}});f.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(a){n.prototype[a]=function(){var b=d.call(arguments);b.unshift(this.models);return f[a].apply(f,b)}});f.each(["groupBy",
"countBy","sortBy"],function(a){n.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var c=h.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},A=/^(\S+)\s*(.*)$/,B=["model","collection","el","id","attributes","className","tagName","events"];f.extend(c.prototype,j,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},
render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof h.$?a:h.$(a);this.el=this.$el[0];b!==!1&&this.delegateEvents();return this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(c){var d=b.match(A),e=d[1],d=d[2],c=f.bind(c,this);e+=".delegateEvents"+this.cid;if(d===
"")this.$el.on(e,c);else this.$el.on(e,d,c)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=f.extend({},f.result(this,"options"),a));f.extend(this,f.pick(a,B));this.options=a},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var a=f.extend({},f.result(this,"attributes"));if(this.id)a.id=f.result(this,"id");this.className&&(a["class"]=f.result(this,"className"));this.setElement(h.$("<"+
f.result(this,"tagName")+">").attr(a),!1)}}});h.sync=function(a,b,c){var d=t[a];f.defaults(c||(c={}),{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var e={type:d,dataType:"json"};if(!c.url)e.url=f.result(b,"url")||v();if(c.data==null&&b&&(a==="create"||a==="update"||a==="patch"))e.contentType="application/json",e.data=JSON.stringify(c.attrs||b.toJSON(c));if(c.emulateJSON)e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{};if(c.emulateHTTP&&(d==="PUT"||d==="DELETE"||
d==="PATCH")){e.type="POST";if(c.emulateJSON)e.data._method=d;var g=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(g)return g.apply(this,arguments)}}if(e.type!=="GET"&&!c.emulateJSON)e.processData=!1;if(e.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled))e.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")};a=c.xhr=h.ajax(f.extend(e,c));b.trigger("request",b,a,c);return a};var t={create:"POST",update:"PUT",
patch:"PATCH","delete":"DELETE",read:"GET"};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};var w=h.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,D=/(\(\?)?:\w+/g,E=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(w.prototype,j,{initialize:function(){},route:function(a,b,c){f.isRegExp(a)||(a=this._routeToRegExp(a));f.isFunction(b)&&(c=b,b="");c||(c=this[b]);var d=this;h.history.route(a,function(e){e=d._extractParameters(a,
e);c&&c.apply(d,e);d.trigger.apply(d,["route:"+b].concat(e));d.trigger("route",b,e);h.history.trigger("route",d,b,e)});return this},navigate:function(a,b){h.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);(a=b.pop())!=null;)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(F,"\\$&").replace(C,"(?:$1)?").replace(D,function(a,b){return b?a:"([^/]+)"}).replace(E,"(.*?)");return RegExp("^"+
a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var q=h.History=function(){this.handlers=[];f.bindAll(this,"checkUrl");if(typeof window!=="undefined")this.location=window.location,this.history=window.history},x=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;q.started=!1;f.extend(q.prototype,j,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,
b){if(a==null)if(this._hasPushState||!this._wantsHashChange||b){var a=this.location.pathname,c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(x,"")},start:function(a){if(q.started)throw Error("Backbone.history has already been started");q.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==!1;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||
!this.history||!this.history.pushState);var a=this.getFragment(),b=document.documentMode,b=H.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7);this.root=("/"+this.root+"/").replace(G,"/");if(b&&this._wantsHashChange)this.iframe=h.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);if(this._hasPushState)h.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)h.$(window).on("hashchange",this.checkUrl);
else if(this._wantsHashChange)this._checkUrlInterval=setInterval(this.checkUrl,this.interval);this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;else if(this._wantsPushState&&this._hasPushState&&b&&a.hash)this.fragment=this.getHash().replace(x,""),this.history.replaceState({},
document.title,this.root+this.fragment+a.search);if(!this.options.silent)return this.loadUrl()},stop:function(){h.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||
this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!q.started)return!1;if(!b||b===!0)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&
a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});h.history=new q;k.extend=n.extend=w.extend=c.extend=q.extend=function(a,b){var c=this,d;d=a&&f.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};f.extend(d,
c,b);var e=function(){this.constructor=d};e.prototype=c.prototype;d.prototype=new e;a&&f.extend(d.prototype,a);d.__super__=c.prototype;return d};var v=function(){throw Error('A "url" property or function must be specified');},s=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b);a.trigger("error",a,d,b)}}}).call(this);r.templating={};r.templating.TemplateSet=function(){this.index={}};
r.templating.TemplateSet.prototype={_templateSettings:{variable:"thing"},_key:function(a,b){return a+"."+b},_create:function(a){return _.template(a,null,this._templateSettings)},set:function(a){_.each(a,function(a){r.config.uncompressedJS&&(a=r.utils.unescapeJson(a));this.index[this._key(a.name,a.style)]=a.template},this)},_defaultStyle:function(a){_.isArray(a)||(a=[a,r.config.renderstyle]);return a},get:function(a){var a=this._defaultStyle(a),b=this._key(a[0],a[1]);if(!this.index[b])throw'"'+a[0]+
"."+a[1]+'" template not found.';template=this.index[b];_.isFunction(template)||(template=this.index[b]=this._create(template));return template},make:function(a,b,c){html=this.get(a)(b);c&&$(c).append(html);return html}};r.templates=new r.templating.TemplateSet;
(function(a,b){a.ScrollUpdater=Backbone.View.extend({selector:null,startUpdate:function(){},update:function(){},endUpdate:function(){},start:function(){this._resetScrollState();this._listen();return this},restart:function(){this._resetScrollState();return this},_resetScrollState:function(){this._elements=this.$el.find(this.selector);_.sortBy(this._elements,function(a){return b(a).offset().top});this._curIndex=0;this._lastScroll=null;this._toUpdate=[];this._totalTime=0;_.defer(b.proxy(this,"_updateThings"))},
_listen:function(){var a=_.throttle(b.proxy(this,"_updateThings"),20);b(window).on("scroll",a)},_updateThings:function(){if(this._elements.length){var c=new Date,e=b(window),d=e.height(),g=e=e.scrollTop(),h=e+d;e<this._lastScroll?g=Math.max(g-Math.floor(d/2),0):h+=Math.ceil(d/2);var d=this._curIndex,f=b(this._elements[d]);if(f.offset().top<g)for(;d<this._elements.length-1&&f.offset().top<g;)f=b(this._elements[d]),d++;else for(;d>0&&f.offset().top>g;)f=b(this._elements[d]),d--;g=0;do f=b(this._elements[d]),
this._toUpdate.push(f),d++,g++;while(d<=this._elements.length-1&&f.offset().top<=h);this._curIndex=d-1;this._lastScroll=e;e=new Date;this._totalTime+=e-c;a.debug("scrollupdater queued",g,"in",e-c,"ms");this._doUpdates()}},cutoff:1E3/60,_doUpdates:function(){this.startUpdate();for(var c=new Date,e=c,d=0,g=[];e-c<this.cutoff;){if(!this._toUpdate.length)break;e=this._toUpdate.shift();g.push(e);this.update(e);d++;e=new Date}this._totalTime+=e-c;a.debug("scrollupdater updated",d,"in",e-c,"ms");a.debug("scrollupdater total",
this._totalTime,"ms");this._toUpdate.length&&_.defer(b.proxy(this,"_doUpdates"));this.endUpdate(b(g))}})})(r,jQuery);
(function(a,b){function c(a){this.opts=_.defaults(a||{},d);this.elCache=b([]);this.refresh=_.throttle(this._refresh,1E3);setInterval(b.proxy(this.refresh,this),2E4);this.refresh()}if(!Date.now)Date.now=function(){return(new Date).getTime()};var e=[[31536E3,a.NP_("a year ago","%(num)s years ago")],[2592E3,a.NP_("a month ago","%(num)s months ago")],[86400,a.NP_("a day ago","%(num)s days ago")],[3600,a.NP_("an hour ago","%(num)s hours ago")],[60,a.NP_("a minute ago","%(num)s minutes ago")]],d={maxage:86400};
c.prototype._refresh=function(){var a=Date.now();this.elCache.each(b.proxy(function(b,c){this.refreshOne(c,a)},this))};c.prototype.updateCache=function(a){this.elCache=a;this.refresh()};c.prototype.refreshOne=function(a,c){c||(c=Date.now());var d=b(a),e=d.data("timestamp"),l;e||(e=d.attr("datetime"),e=Date.parse(e),d.data("timestamp",e));l=(c-e)/1E3;this.opts.maxage!==!1&&l>this.opts.maxage?d.removeClass("live-timestamp"):(e=this.formatTime(d,l,e,c),d.text(e))};c.prototype.formatTime=function(c,d){var f=
a._("just now");b.each(e,function(b,c){var e=Math.floor(d/c[0]),g;if(e>0)return g=c[1],f=a.P_(g[0],g[1],e).format({num:e}),!1});return f};a.TimeText=c})(r,jQuery);
r.ui.init=function(){$.cookie("reddit_first")?($.cookie("reddit_first",null,{domain:r.config.cur_domain}),store.safeSet("ui.shown.welcome",!0)):store.safeGet("ui.shown.welcome")!=!0&&($(".infobar.welcome").show(),store.safeSet("ui.shown.welcome",!0));var a=window.matchMedia?matchMedia("(max-device-width: 700px)").matches:$(window).width()<700,b=$.url().attr("path")=="/";a&&b&&r.config.renderstyle!="compact"&&(a=$('<div class="infobar mellow">').html(r.utils.formatMarkdownLinks(r._("Looks like you're browsing on a small screen. Would you like to try [reddit's mobile interface](%(url)s)?").format({url:location+
".compact"}))),$("body > .content > :not(.infobar):first").before(a));$(".help-bubble").each(function(a,b){$(b).data("HelpBubble",new r.ui.Bubble({el:b}))});$(".submit_text").each(function(a,b){$(b).data("SubredditSubmitText",new r.ui.SubredditSubmitText({el:b}))});if(r.config.new_window)$(document.body).on("click","a.may-blank, .may-blank-within a",function(){if(!this.target)this.target="_blank";return!0});r.ui.PermissionEditor.init();r.ui.initLiveTimestamps()};
r.ui.TimeTextScrollListener=r.ScrollUpdater.extend({initialize:function(a){this.timeText=a.timeText;this.timeText.updateCache($(this.selector))},selector:".live-timestamp:visible",endUpdate:function(a){this.timeText.updateCache(a)}});r.ui.initLiveTimestamps=function(){if($(".sitetable").length){var a=new r.ui.TimeTextScrollListener({el:".sitetable",timeText:new r.TimeText});a.start();$(document).on("new_things_inserted",function(){a.restart()})}};
r.ui.showWorkingDeferred=function(a,b){if(b){var c=$(a);c.data("_workingCount",(c.data("_workingCount")||0)+1);var e=setTimeout(function(){c.addClass("working")},200);b.always(function(){clearTimeout(e);var a=Math.max(0,c.data("_workingCount")-1);c.data("_workingCount",a);a==0&&c.removeClass("working")});return b}};r.ui.refreshListing=function(){var a=$.url(),b=a.param();b.bare="y";return $.ajax({type:"GET",url:a.attr("base")+a.attr("path"),data:b}).done(function(a){$("body > .content").html(a).find(".promotedlink.promoted:visible").trigger("onshow")})};
r.ui.Form=function(a){r.ui.Base.call(this,a);this.$el.submit($.proxy(function(a){a.preventDefault();this.submit(a)},this))};
r.ui.Form.prototype=$.extend(new r.ui.Base,{showStatus:function(a,b){this.$el.find(".status").show().toggleClass("error",!!b).text(a)},showErrors:function(a){statusMsgs=[];$.each(a,$.proxy(function(a,c){var e=c[1],d=c[2],d=this.$el.find(".error."+c[0]+(d?".field-"+d:""));d.length?d.show().text(e):statusMsgs.push(e)},this));statusMsgs.length&&this.showStatus(statusMsgs.join(", "),!0)},resetErrors:function(){this.$el.find(".error").hide()},checkCaptcha:function(a){this.$el.has('input[name="captcha"]').length&&
$.grep(a,function(a){return a[0]=="badCaptcha"})&&$.request("new_captcha",{id:this.$el.attr("id")})},serialize:function(){return this.$el.serializeArray()},submit:function(){this.resetErrors();r.ui.showWorkingDeferred(this.$el,this._submit()).done($.proxy(this,"handleResult")).fail($.proxy(this,"_handleNetError"))},_submit:function(){},handleResult:function(a){this.checkCaptcha(a.json.errors);this._handleResult(a)},_handleResult:function(a){this.showErrors(a.json.errors)},_handleNetError:function(a){this.showStatus(r._("an error occurred (status: %(status)s)").format({status:a.status}),
!0)}});
r.ui.Bubble=Backbone.View.extend({showDelay:150,hideDelay:750,animateDuration:150,initialize:function(){this.$parent=this.options.parent||this.$el.parent();this.options.trackHover!=!1&&(this.$el.hover($.proxy(this,"queueShow"),$.proxy(this,"queueHide")),this.$parent.hover($.proxy(this,"queueShow"),$.proxy(this,"queueHide")),this.$parent.click($.proxy(this,"queueShow")))},position:function(){var a=this.$parent.offset(),b=$("body").offset(),c,e;this.$el.is(".anchor-top")||this.$el.is(".anchor-top-centered")?(c=
this.$parent.outerWidth(!0)-this.$el.outerWidth(!0),e=this.$parent.outerHeight(!0)+5,this.$el.css({left:Math.max(a.left+c,0),top:a.top+e-b.top})):this.$el.is(".anchor-top-left")?(e=this.$parent.outerHeight(!0)+5,this.$el.css({left:a.left,top:a.top+e-b.top})):this.$el.is(".anchor-right-fixed")?(c=32,e=0,a.top-=$(document).scrollTop(),a.left-=$(document).scrollLeft(),this.$el.css({top:r.utils.clamp(a.top-e,0,$(window).height()-this.$el.outerHeight()),left:r.utils.clamp(a.left-c-this.$el.width(),0,$(window).width())})):
this.$el.is(".anchor-left")?(c=this.$parent.outerWidth(!0)+16,this.$el.css({left:a.left+c,top:a.top+0-b.top})):(c=16,e=0,a.right=$(window).width()-a.left,this.$el.css({right:a.right+c,top:a.top+e-b.top}))},show:function(){this.cancelTimeout();if(!this.$el.is(":visible")&&(this.trigger("show"),$("body").append(this.$el),this.$el.css("visibility","hidden").show(),this.render(),this.position(),this.$el.css({opacity:1,visibility:"visible"}),this.options.group&&this.options.group.current&&this.options.group.current!=
this?this.options.group.current.hideNow():this._animate("show"),this.options.group))this.options.group.current=this},hideNow:function(){this.cancelTimeout();if(this.options.group&&this.options.group.current==this)this.options.group.current=null;this.$el.hide()},hide:function(a){this.$el.is(":visible")?this._animate("hide",$.proxy(function(){this.hideNow();a&&a()},this)):a&&a()},_animate:function(a,b){if(this.animateDuration){var c,e;this.$el.is(".anchor-top")||this.$el.is(".anchor-top-centered")||
this.$el.is(".anchor-top-left")?(c="top",e="-=5"):this.$el.is(".anchor-right-fixed")?(c="right",e="-=5"):this.$el.is(".anchor-left")?(c="left",e="+=5"):(c="right",e="-=5");var d=this.$el.css(c);hideProps={opacity:0};hideProps[c]=e;showProps={opacity:1};showProps[c]=d;var g,h;a=="show"?(g=hideProps,h=showProps):a=="hide"&&(g=showProps,h=hideProps);this.$el.css(g).animate(h,this.animateDuration,b)}else b&&b()},cancelTimeout:function(){if(this.timeout)clearTimeout(this.timeout),this.timeout=null},queueShow:function(){this.cancelTimeout();
this.timeout=setTimeout($.proxy(this,"show"),this.showDelay)},queueHide:function(){this.cancelTimeout();this.timeout=setTimeout($.proxy(this,"hide"),this.hideDelay)}});
r.ui.PermissionEditor=function(a){r.ui.Base.call(this,a);var b={};this.$el.find('input[type="hidden"]').each(function(a,e){b[e.name]=e.value});a=b.type;this.form_id=a+"-permissions-"+b.name;this.permission_info=r.permissions[a];this.sorted_perm_keys=$.map(this.permission_info,function(a,b){return b});this.sorted_perm_keys.sort();this.original_perms=this._parsePerms(b.permissions);this.embedded=this.$el.find("form").length==0;this.$menu=null;this.embedded?(this.$permissions_field=this.$el.find('input[name="permissions"]'),
this.$menu_controller=this.$el.siblings(".permissions-edit")):this.$menu_controller=this.$el.closest("tr").find(".permissions-edit");this.$menu_controller.find("a").click($.proxy(this,"show"));this.updateSummary()};r.ui.PermissionEditor.init=function(){function a(a){$(a).find(".permissions").each(function(a,b){$(b).data("PermissionEditor",new r.ui.PermissionEditor(b))})}a("body");for(var b in r.permissions)$("."+b+"-table").on("insert-row","tr",function(){a(this)})};
r.ui.PermissionEditor.prototype=$.extend(new r.ui.Base,{_parsePerms:function(a){var b={};a.split(",").forEach(function(a){b[a.substring(1)]=a[0]=="+"});return b.all?{all:!0}:b},_serializePerms:function(a){if(a.all)return"+all";else{var b=[],c;for(c in a)b.push((a[c]?"+":"-")+c);return b.join(",")}},_getNewPerms:function(){if(!this.$menu)return null;var a={};this.$menu.find('input[type="checkbox"]').each(function(b,c){a[$(c).attr("name")]=$(c).prop("checked")});return a},_makeMenuLabel:function(a){var b=
$.proxy(this,"updateSummary"),c=this.permission_info[a],e=$('<input type="checkbox">').attr("name",a).prop("checked",this.original_perms[a]),d=$("<label>").append(e).click(function(a){a.stopPropagation()});a=="all"?(e.change(function(){var a=e.is(":checked");d.siblings().toggleClass("disabled",a).find('input[type="checkbox"]').prop("disabled",a);b()}),d.append(document.createTextNode(r._("full permissions")))):c&&(e.change(b),d.append(document.createTextNode(r._(c.title))),d.attr("title",r._(c.description)));
return d},show:function(a){close_menus(a);this.$menu=$('<div class="permission-selector drop-choices">');this.$menu.append(this._makeMenuLabel("all"));for(var b in this.sorted_perm_keys)this.$menu.append(this._makeMenuLabel(this.sorted_perm_keys[b]));this.$menu.on("close_menu",$.proxy(this,"hide")).find("input").first().change().end();if(!this.embedded)a=this.$el.find("form").clone(),a.attr("id",this.form_id),a.click(function(a){a.stopPropagation()}),this.$menu.append("<hr>",a),this.$permissions_field=
this.$menu.find('input[name="permissions"]');this.$menu_controller.parent().append(this.$menu);open_menu(this.$menu_controller[0]);return!1},hide:function(){if(this.$menu){if(this.embedded)this.original_perms=this._getNewPerms(),this.$permissions_field.val(this._serializePerms(this.original_perms));this.$menu.remove();this.$menu=null;this.updateSummary()}},_renderBit:function(a){var b=this.permission_info[a],a=a=="all"?r._("full permissions"):b?r._(b.title):a,a=$('<span class="permission-bit"/>').text(a);
b&&a.attr("title",r._(b.description));return a},updateSummary:function(){var a=this._getNewPerms(),b=[];if(a&&a.all)b.push(this._renderBit("all").toggleClass("added",this.original_perms.all!=!0));else{if(this.original_perms.all&&!a)b.push(this._renderBit("all"));else if(!this.original_perms.all)for(var c in this.original_perms)this.original_perms[c]&&(this.embedded&&(!a||a[c])&&b.push(this._renderBit(c)),this.embedded||b.push(this._renderBit(c).toggleClass("removed",a!=null&&!a[c])));if(a)for(c in a)this.permission_info[c]&&
a[c]&&!this.original_perms[c]&&b.push(this._renderBit(c).toggleClass("added",!this.embedded))}b.length||b.push($('<span class="permission-bit">').text(r._("no permissions")).addClass("none"));c=$('<div class="permission-summary">');for(var e=0;e<b.length;e++)e>0&&c.append(", "),c.append(b[e]);c.toggleClass("edited",this.$menu!=null);this.$el.find(".permission-summary").replaceWith(c);a&&this.$permissions_field&&this.$permissions_field.val(this._serializePerms(a))},onCommit:function(a){this.$el.find('input[name="permissions"]').val(a);
this.original_perms=this._parsePerms(a);this.hide()}});r.ui.scrollFixed=function(a){this.$el=$(a);this.$standin=null;this.onScroll();$(window).bind("scroll resize",_.bind(_.throttle(this.onScroll,20),this))};
r.ui.scrollFixed.prototype={onScroll:function(){if(!this.$el.is(".scroll-fixed")){var a=this.$el.outerHeight(!0)-this.$el.outerHeight(!1);this.origTop=this.$el.offset().top-a}if(this.$el.height()<$(window).height()&&$(window).scrollTop()>this.origTop){if(!this.$standin)this.$standin=$("<"+this.$el.prop("nodeName")+">").css({width:this.$el.width(),height:this.$el.height()}).attr("class",this.$el.attr("class")).addClass("scroll-fixed-standin"),this.$el.addClass("scroll-fixed").css({position:"fixed",
top:0}),this.$el.before(this.$standin)}else if(this.$standin)this.$el.removeClass("scroll-fixed").css({position:"",top:""}),this.$standin.remove(),this.$standin=null}};
r.ui.ConfirmButton=Backbone.View.extend({confirmTemplate:_.template('<span class="confirmation"><span class="prompt"><%- are_you_sure %></span><button class="yes"><%- yes %></button> / <button class="no"><%- no %></button></div>'),events:{click:"click"},initialize:function(){this.$target=this.$el;this.$target.wrap("<span>");this.setElement(this.$target.parent());this.$el.attr("class",this.$target.attr("class")).addClass("confirm-button");this.$target.attr("class",null)},click:function(a){a=$(a.target);
this.$target.is(a)?(this.$target.hide(),this.$el.append(this.confirmTemplate({are_you_sure:r._("are you sure?"),yes:r._("yes"),no:r._("no")}))):a.is(".no")?(this.$(".confirmation").remove(),this.$target.show()):a.is(".yes")&&this.$target.trigger("confirm")}});
r.ui.SubredditSubmitText=Backbone.View.extend({initialize:function(){this.lookup=_.throttle(this._lookup,500);this.cache=new r.utils.LRUCache;this.$input=$("#sr-autocomplete");this.$input.on("sr-changed change input",_.bind(this.lookup,this));this.$sr=this.$el.find(".sr").first();this.$content=this.$el.find(".content").first();this.$content.text().trim()&&(this.$sr.text(r.config.post_site),this.show())},_lookup:function(){this.$content.empty();var a=this.$input.val();this.$sr.text(a);this.$el.addClass("working");
this.req&&this.req.abort&&this.req.abort();this.req=this.cache.ajax(a,{url:"/r/"+a+"/api/submit_text/.json",dataType:"json"}).done(_.bind(this.settext,this,a)).fail(_.bind(this.error,this))},show:function(){this.$el.addClass("enabled")},hide:function(){this.$el.removeClass("enabled")},error:function(){delete this.req;this.hide()},settext:function(a,b){delete this.req;!b.submit_text||!b.submit_text.trim()?this.hide():(this.$sr.text(a),this.$content.html($.unsafe(b.submit_text_html)),this.$el.removeClass("working"),
this.show())}});
r.login={post:function(a,b){var c=$('input[name="user"]',a.$el).val(),e=r.config.https_endpoint||"http://"+r.config.ajax_domain,c=e+"/api/"+b+"/"+c;if(r.config.currentOrigin==e||$.support.cors)return e=a.serialize(),e.push({name:"api_type",value:"json"}),$.ajax({url:c,type:"POST",dataType:"json",data:e,xhrFields:{withCredentials:!0}});else{var d=$("<iframe>"),g=a.$el.clone(!0),e=("resp"+Math.random()).replace(".","");d.css("display","none").attr("name",e).appendTo("body");d[0].contentWindow.name=e;
g.unbind().css("display","none").attr("action",c).attr("target",e).appendTo("body");$("<input>").attr({type:"hidden",name:"api_type",value:"json"}).appendTo(g);$("<input>").attr({type:"hidden",name:"hoist",value:r.login.hoist.type}).appendTo(g);c=r.login.hoist.watch(b);r.config.debug||c.done(function(){d.remove();g.remove()});g.submit();return c}}};
r.login.hoist={type:"cookie",watch:function(a){var b="hoist_"+a,c=new $.Deferred,e=setInterval(function(){if(data=$.cookie(b)){try{data=JSON.parse(data)}catch(a){data=null}$.cookie(b,null,{domain:r.config.cur_domain,path:"/"});clearInterval(e);c.resolve(data)}},100);return c}};
r.login.ui={init:function(){if(!r.config.logged)$(".content form.login-form, .side form.login-form").each(function(a,b){new r.ui.LoginForm(b)}),$(".content form.register-form").each(function(a,b){new r.ui.RegisterForm(b)}),this.popup=new r.ui.LoginPopup($(".login-popup")[0]),$(document).delegate(".login-required","click",$.proxy(this,"loginRequiredAction"))},loginRequiredAction:function(a){if(r.config.logged)return!0;else{var a=$(a.target),b=a.attr("href"),c;b&&b!="#"&&!/\/login\/?$/.test(b)?c=b:
(a=a.thing(),a.length&&(c=a.find(".comments").attr("href")));this.popup.showLogin(!0,c&&$.proxy(function(){this.popup.loginForm.$el.addClass("working");window.location=c},this));return!1}}};r.ui.LoginForm=function(){r.ui.Form.apply(this,arguments)};
r.ui.LoginForm.prototype=$.extend(new r.ui.Form,{showErrors:function(a){r.ui.Form.prototype.showErrors.call(this,a);a.length&&this.$el.find(".recover-password").addClass("attention")},showStatus:function(){this.$el.find(".error").css("opacity",1);r.ui.Form.prototype.showStatus.apply(this,arguments)},resetErrors:function(){if(this.$el.hasClass("login-form-side")){var a=this.$el.find(".error");a.is(":visible")&&a.fadeTo(100,0.35)}else r.ui.Form.prototype.resetErrors.apply(this,arguments)},_submit:function(){return r.login.post(this,
"login")},_handleResult:function(a){if(a.json.errors.length)r.ui.Form.prototype._handleResult.call(this,a);else if(this.successCallback)this.successCallback(a);else{this.$el.addClass("working");var a=r.config.extension?"/."+r.config.extension:"/",a=/\/login\/?$/.test($.url().attr("path"))?a:window.location,b=this.$el.find('input[name="dest"]').val();window.location=b||a}},_handleNetError:function(a){r.ui.Form.prototype._handleNetError.apply(this,arguments);a.status==0&&r.config.currentOrigin!=r.config.https_endpoint&&
$("<p>").append($("<a>").text(r._("try using our secure login form.")).attr("href",r.config.https_endpoint+"/login")).appendTo(this.$el.find(".status"))},focus:function(){this.$el.find('input[name="user"]').focus()}});r.ui.RegisterForm=function(){r.ui.Form.apply(this,arguments);this.checkUsernameDebounced=_.debounce($.proxy(this,"checkUsername"),500);this.$user=this.$el.find('[name="user"]');this.$user.on("keyup",$.proxy(this,"usernameChanged"));this.$submit=this.$el.find(".submit button")};
r.ui.RegisterForm.prototype=$.extend(new r.ui.Form,{maxName:0,usernameChanged:function(){var a=this.$user.val();if(a!=this._priorName)this._priorName=a,this.$el.find(".error.field-user").hide(),this.$el.removeClass("name-checking name-available name-taken"),this.maxName=Math.max(this.maxName,a.length),a&&this.maxName>=3&&(this.$el.addClass("name-checking"),this.checkUsernameDebounced()),this.$submit.attr("disabled",!1)},checkUsername:function(){var a=this.$user.val();a?$.ajax({url:"/api/username_available.json",
data:{user:a},success:$.proxy(this,"displayUsernameStatus"),complete:$.proxy(function(){this.$el.removeClass("name-checking")},this)}):this.$el.removeClass("name-available name-taken")},displayUsernameStatus:function(a){a.json&&a.json.errors?(this.showErrors(a.json.errors),this.$submit.attr("disabled",!0)):(this.$el.addClass(a?"name-available":"name-taken"),this.$submit.attr("disabled",a==!1))},_submit:function(){return r.login.post(this,"register")},_handleResult:r.ui.LoginForm.prototype._handleResult,
focus:r.ui.LoginForm.prototype.focus});r.ui.LoginPopup=function(a){r.ui.Base.call(this,a);this.loginForm=new r.ui.LoginForm(this.$el.find("form.login-form:first"));this.registerForm=new r.ui.RegisterForm(this.$el.find("form.register-form:first"))};
r.ui.LoginPopup.prototype=$.extend(new r.ui.Base,{show:function(a,b){this.loginForm.successCallback=b;this.registerForm.successCallback=b;$.request("new_captcha",{id:this.$el.attr("id")});this.$el.find(".cover-msg").toggle(!!a).end().find(".popup").css("top",$(document).scrollTop()).end().show()},showLogin:function(){this.show.apply(this,arguments);this.loginForm.focus()},showRegister:function(){this.show.apply(this,arguments);this.registerForm.focus()}});
$(function(){function a(a){$(a).parent().parent().addClass("edited");$(a).parent().parent().find(".status").empty()}function b(){$(this).data("saved")!=$(this).val()&&a(this)}function c(a){a.preventDefault();return post_form(this.parentNode,a.data.action)}function e(a){a.preventDefault();$(this).removeClass("edited");return post_form(this,a.data.action)}function d(a){if(a.data("name"))return{name:a.data("name")};return{link:a.thing_id()}}function g(){$(".flairselector li").removeClass("selected");
$(this).addClass("selected");var a=$(this).parent().parent().siblings("form")[0];$(a).children('input[name="flair_template_id"]').val(this.id);var a=$(a).children(".customizer"),b=a.children("input");$(this).hasClass("texteditable")?(a.addClass("texteditable"),b.removeAttr("disabled"),b.css("display","block"),b.val($.trim($(this).find(".flair, .linkflairlabel").text())).select(),b.keyup(function(){$(".flairselection .flair, .flairselection .linkflairlabel").text($(b).val()).attr("title",$(b).val())})):
(a.removeClass("texteditable"),b.attr("disabled","disabled").hide());a=$(".flairselector .flairremove").detach();$(".flairselection").html($(this).first().children().clone()).append(a);$(".flairselector .flairremove").css("display","inline-block");return!1}function h(){var a=$(this).parent().parent();$(a).children('input[name="flair_template_id"]').val("");$(a).children(".customizer").hide();a=$(".flairselector .flairremove").detach();$(a).hide();$(".flairselector li").removeClass("selected");$(".flairselection").empty().append(a)}
function f(){$(this).find(".status").html(reddit.status_msg.submitting).show();var a=$(this.parentNode.parentNode).find(".flairselectbtn");simple_post_form(this,"selectflair",d(a));return!1}$("#tabbedpane-grant").on("submit",".flair-entry",{action:"flair"},e);$("#tabbedpane-grant").on("click",".flairdeletebtn",{action:"deleteflair"},c);$("#tabbedpane-templates, #tabbedpane-link_templates").on("submit",".flair-entry",{action:"flairtemplate"},e);$("form.clearflairtemplates").on("submit",{action:"clearflairtemplates"},
e);$(".flairlist").on("focus",".flaircell input",function(){a(this)}).on("keyup",".flaircell input",b).on("change",".flaircell input",b).on("click",".flairtemplate .flairdeletebtn",{action:"deleteflairtemplate"},c);$(".flairtoggle").submit(function(){return post_form(this,"setflairenabled")});$(".flairtoggle input").change(function(){$(this).parent().submit()});$(document).on("click",".tagline .flairselectbtn, .thing .flairselectbtn",function(a){function b(a){var c=$(a).children().length,d=Math.max(1,
Math.min(3,Math.ceil(c/10))),e=Math.ceil(c/d),f=Math.max(150,$(a).width());$(a).width(f);if(d>1){$(a).css("float","left");for(var g=d*e-c,h=1;h<d;h++){var j=e;h<=g&&j--;var l=c-j;c-=j;j=$(a).children().slice(l).remove();$(j).width(f);$(a).after($("<ul>").css("float","left").append(j))}}return d*(f+5)+50}close_menus(a);var c=this,e=$(c).siblings(".flairselector")[0];$(e).html('<img class="flairthrobber" src="'+r.utils.staticURL("throbber.gif")+'" />').addClass("active").height(18).width(18).css("padding-left",
4).css("padding-top",4).css("padding-bottom",4).css("padding-right",4).css("left",$(c).position().left+$(c).width()-18+"px").css("top",$(c).position().top+"px");a=d($(this));$.request("flairselector",a,function(a){$(e).html(a);var a=$(".flairselector ul"),a=Math.max(200,a.length?b(a):$(".error").width()+20),d=Math.max(100,$(c).position().left+$(c).width()-a);$(e).height("auto").width(a).css("left",d+"px").click(!1).find(".flairselection").click(!1).end().find("form").click(function(a){a.stopPropagation()}).submit(f).end().find(".customizer input").attr("disabled",
"disabled").end().find("li.selected").each(g).end().find("li:not(.error)").click(g).end().find(".flairremove").click(h).end()},!0,"html");return!1});$(".flairselector .dropdown").click(function(){open_menu(this);$(this).addClass("active");return!1})});r.interestbar={init:function(){new r.ui.InterestBar($(".sr-interest-bar"))}};
r.ui.InterestBar=function(){r.ui.Base.apply(this,arguments);this.$query=this.$el.find(".query");this.queryChangedDebounced=_.debounce($.proxy(this,"queryChanged"),500);this.$query.on("keyup",$.proxy(this,"keyPressed"));this.$query.on("focus",$.proxy(function(){this.$el.addClass("focus")},this)).on("blur",$.proxy(function(){this.$el.removeClass("focus")},this))};
r.ui.InterestBar.prototype={keyPressed:function(){var a=this.$query.val(),a=$.trim(a);if(a!=this._lastQuery)this._lastQuery=a,this.queryChangedDebounced(a),a&&a.length>1?this.$el.addClass("working"):(this.hideResults(),this.$el.removeClass("working error"))},queryChanged:function(a){a&&a.length>1&&$.ajax({url:"/api/subreddits_by_topic.json",data:{query:a},success:$.proxy(this,"displayResults"),error:$.proxy(this,"displayError")})},displayResults:function(a){this.$el.removeClass("working error");var b=
this.$el.find(".results li:first"),c=this.$el.find(".results li:last"),e=_.template('<li><a href="/r/<%= name %>" target="_blank">/r/<%= name %></a></li>');this.$el.find(".results").empty().append(b).append(_.map(a,e).join("")).append(c).slideDown(150)},hideResults:function(){this.$el.find(".results").slideUp(150)},displayError:function(a){this.$el.removeClass("working").addClass("error").find(".error-caption").text(r._("an error occurred. please try again later! (status: %(status)s)").format({status:a.status}));
this.hideResults()}};
r.visited={key:"visited",init:function(){this.sendVisits=_.throttle(this._sendVisits,100);r.config.logged&&r.config.store_visits&&($(".content").on("mousedown keydown",".link:not(.visited) a.title, .link:not(.visited) a.thumbnail",_.bind(this.onVisit,this)),$(".content").on("visit",".link:not(.visited)",_.bind(this.onVisit,this)),this.sendVisits())},onVisit:function(a){a.type=="keydown"&&a.which!=13||(this.storeVisit($(a.target).closest(".thing").data("fullname")),this.sendVisits())},storeVisit:function(a){var b=
store.safeGet(this.key)||[];b.push(a);store.safeSet(this.key,b)},_sendVisits:function(){var a=store.safeGet(this.key)||[];a.length&&(a=_.last(_.uniq(a),100),r.ajax({type:"POST",url:"/api/store_visits",data:{links:a.join(",")}}),store.safeSet(this.key,[]),$.things.apply($,a).addClass("visited"))}};
r.wiki={request:function(a){if(r.config.logged)a.data.uh=r.config.modhash;a.data.page=r.config.wiki_page;$.ajax(a)},baseApiUrl:function(){return r.wiki.baseUrl(!0)},baseUrl:function(a){var b="";a&&(b+="/api");b+="/wiki";r.config.is_fake||(b="/r/"+r.config.post_site+b);return b},init:function(){$("body").delegate(".wiki-page .revision_hide","click",this.toggleHide);$("body").delegate(".wiki-page .revision_delete","click",this.toggleDelete);$("body").delegate(".wiki-page .toggle-source","click",this.toggleSource)},
toggleSource:function(a){a.preventDefault();$(".wiki-page .source").toggle("slow")},toggleDelete:function(a){a.preventDefault();var a=$(this),b=r.wiki.baseApiUrl()+"/delete",c=a.parents(".revision"),e=c.hasClass("deleted");c.toggleClass("deleted");r.wiki.request({url:b,type:"POST",dataType:"json",data:{revision:a.data("revision"),deleted:!e},error:function(){c.toggleClass("deleted")},success:function(a){a.status?c.addClass("deleted"):c.removeClass("deleted")}})},toggleHide:function(a){a.preventDefault();
var a=$(this),b=r.wiki.baseApiUrl()+"/hide",c=a.parents(".revision");c.toggleClass("hidden");r.wiki.request({url:b,type:"POST",dataType:"json",data:{revision:a.data("revision")},error:function(){c.toggleClass("hidden")},success:function(a){a.status?c.addClass("hidden"):c.removeClass("hidden")}})},addUser:function(a){a.preventDefault();$("#usereditallowerror").hide();var a=$(a.target),b=r.wiki.baseApiUrl()+"/alloweditor/add";r.wiki.request({url:b,type:"POST",data:{username:a.find('[name="username"]').val()},
dataType:"json",error:function(){$("#usereditallowerror").show()},success:function(){location.reload()}})},submitEdit:function(a){a.preventDefault();var b=$(a.target),a=r.wiki.baseApiUrl()+"/edit",c=$("#wiki_edit_conflict"),e=$("#wiki_special_error");c.hide();e.hide();params=r.utils.serializeForm(b);$("#wiki_save_button").attr("disabled",!0);b.addClass("working");r.wiki.request({url:a,type:"POST",dataType:"json",data:params,error:function(){b.removeClass("working");$("#wiki_save_button").removeAttr("disabled")},
success:function(){window.location=r.wiki.baseUrl()+"/"+r.config.wiki_page},statusCode:{409:function(a){var a=JSON.parse(a.responseText),e=b.children("#wiki_page_content"),h=c.children("#yourdiff");c.children("#youredit").val(e.val());h.html($.unsafe(a.diffcontent));b.children("#previous").val(a.newrevision);e.val(a.newcontent);c.fadeIn("slow")},415:function(a){var a=JSON.parse(a.responseText).special_errors,b=e.children("#specials");b.empty();for(i in a)b.append($("<p>").text(a[i]));e.fadeIn("slow")},
429:function(a){var a=JSON.parse(a.responseText).message,b=e.children("#specials");b.empty();b.text(a);e.fadeIn("slow")}}})},goCompare:function(){v1=$("input:radio[name=v1]:checked").val();v2=$("input:radio[name=v2]:checked").val();url=r.wiki.baseUrl()+"/"+r.config.wiki_page+"?v="+v1;v2!=v1&&(url+="&v2="+v2);window.location=url},helpon:function(a){$(a).parents("form").children(".markhelp:first").show()},helpoff:function(a){$(a).parents("form").children(".markhelp:first").hide()}};
r.apps={init:function(){$(".authorized-app").delegate(".app-permissions li","mouseover mouseout",function(a){a.type=="mouseover"?$(this).find(".app-scope").show():$(this).find(".app-scope").hide()});$("#developed-apps").delegate(".edit-app-button","click",function(){$(this).toggleClass("collapsed").closest(".developed-app").removeClass("collapsed").find(".app-developers").remove().end().find(".edit-app").slideToggle().removeClass("collapsed").end()}).delegate(".edit-app-icon-button","click",function(){$(this).toggleClass("collapsed").closest(".developed-app").find(".ajax-upload-form").show()});
$("#create-app-button").click(function(){$(this).hide();$("#create-app").fadeIn()})},revoked:function(a){$(a).closest(".authorized-app").fadeOut()},deleted:function(a){$(a).closest(".developed-app").fadeOut()}};
r.gold={_googleCheckoutAnalyticsLoaded:!1,init:function(){$("div.content").on("click","a.give-gold, .gold-payment .close-button",$.proxy(this,"_toggleThingGoldForm"));$(".stripe-gold").click(function(){$("#stripe-payment").show()});$("#stripe-payment.charge .stripe-submit").on("click",function(){r.gold.tokenThenPost("stripecharge/gold")});$("#stripe-payment.modify .stripe-submit").on("click",function(){r.gold.tokenThenPost("modify_subscription")})},_toggleThingGoldForm:function(a){var a=$(a.target),
b=a.thing(),c=a.thing_id(),e="gold_form_"+c,d=$("#"+e);if(b.hasClass("user-gilded")||b.hasClass("deleted")||b.find(".author:first").text()==r.config.logged)return!1;if(d.length)return d.toggle(),!1;if(!this._googleCheckoutAnalyticsLoaded)$.getScript("//checkout.google.com/files/digital/ga_post.js"),this._googleCheckoutAnalyticsLoaded=!0;var b=b.hasClass("link")?"cloneable-link":"cloneable-comment",g=$(".gold-form."+b+":first").clone(),d=a.thing().find(".entry .author:first").text(),h=g.find(".passthrough"),
f=g.find('[name="cbbaseurl"]').val();g.removeClass(b).attr("id",e).find("p:first-child em").text(d).end().find("button").attr("disabled","");h.val("");a.new_thing_child(g);g.show();var j=setTimeout(function(){g.addClass("working");g.find("button").addClass("disabled")},200);$.request("generate_payment_blob.json",{thing:c},function(a){clearTimeout(j);g.removeClass("working");h.val(a);g.find(".stripe-gold").on("click",function(){window.open("/gold/creditgild/"+a)});g.find(".coinbase-gold").on("click",
function(){window.open(f+"?c="+a)});g.find("button").removeAttr("disabled").removeClass("disabled")});return!1},gildThing:function(a,b,c){var e=$(".id-"+a);if(e.length){var a=e.children(".entry").find("p.tagline"),d=a.find(".gilded-icon");c==null&&(c=d.data("count")||0,c++);e.addClass("gilded user-gilded");d.length||(d=$("<span>").addClass("gilded-icon"),a.append(d));d.attr("title",b).data("count",c);c>1&&d.text("x"+c);e.children(".entry").find(".give-gold").parent().remove()}else console.log("couldn't gild thing "+
a)},tokenThenPost:function(a){r.gold.makeStripeToken(function(b,c){var e=$("#stripe-payment"),d=e.find(".stripe-submit"),g=e.find(".status"),h=e.find('[name="stripeToken"]');c.error?(d.removeAttr("disabled"),g.html(c.error.message)):(h.val(c.id),post_form(e,a))})},makeStripeToken:function(a){var b=$("#stripe-payment"),c=b.find('[name="stripePublicKey"]').val(),e=b.find(".stripe-submit"),d=b.find(".status");b.find('[name="stripeToken"]');var g=b.find(".card-name").val(),h=b.find(".card-number").val(),
f=b.find(".card-cvc").val(),j=b.find(".card-expiry-month").val(),l=b.find(".card-expiry-year").val(),o=b.find(".card-address_line1").val(),m=b.find(".card-address_line2").val(),k=b.find(".card-address_city").val(),p=b.find(".card-address_state").val(),n=b.find(".card-address_country").val(),b=b.find(".card-address_zip").val();Stripe.setPublishableKey(c);g?Stripe.validateCardNumber(h)?Stripe.validateExpiry(j,l)?Stripe.validateCVC(f)?o?k?p?n?b?(d.text(reddit.status_msg.submitting),e.attr("disabled",
"disabled"),Stripe.createToken({name:g,number:h,cvc:f,exp_month:j,exp_year:l,address_line1:o,address_line2:m,address_city:k,address_state:p,address_country:n,address_zip:b},a)):d.text(r._("missing zip code")):d.text(r._("missing country")):d.text(r._("missing state or province")):d.text(r._("missing city")):d.text(r._("missing address")):d.text(r._("invalid cvc")):d.text(r._("invalid expiration date")):d.text(r._("invalid credit card number")):d.text(r._("missing name"));return!1}};
(function(a){a.gild_thing=function(b,c){r.gold.gildThing(b,c);a("#gold_form_"+b).fadeOut(400)}})(jQuery);
r.multi={init:function(){this.multis=new r.multi.GlobalMultiCache;this.mine=new r.multi.MyMultiCollection;this.mine.fetch=_.throttle(this.mine.fetch,6E4);var a=$(".multi-details");if(a.length){var b=this.multis.touch(a.data("path"));b.fetch();a=(new r.multi.MultiDetails({model:b,el:a})).render();location.hash=="#created"&&a.focusAdd();b=$("#multi-recs");b.length&&a.initRecommendations(b)}var c={};$(".subscribe-button").each(function(a,b){new r.multi.SubscribeButton({el:b,bubbleGroup:c})});$(".listing-chooser").each(function(a,
b){new r.multi.ListingChooser({el:b})})}};r.multi.MultiRedditList=Backbone.Collection.extend({model:Backbone.Model.extend({initialize:function(){this.id=this.get("name").toLowerCase()}}),comparator:function(a){return a.id},getByName:function(a){return this.get(a.toLowerCase())}});r.multi.MultiRedditDescription=Backbone.Model.extend({parse:function(a){return a.data},isNew:function(){return!1}});
r.multi.MultiReddit=Backbone.Model.extend({idAttribute:"path",url:function(){return r.utils.joinURLs("/api/multi",this.id)},defaults:{visibility:"private"},initialize:function(a,b){this.uncreated=b&&!!b.isNew;this.subreddits=new r.multi.MultiRedditList(this.get("subreddits"),{url:this.url()+"/r/",parse:!0});this.description=new r.multi.MultiRedditDescription(null,{url:this.url()+"/description"});this.on("change:subreddits",function(a,b){this.subreddits.set(b,{parse:!0})},this);this.subreddits.on("request",
function(a,b,d){this.trigger("request",a,b,d)},this)},parse:function(a){return a.data},toJSON:function(){data=Backbone.Model.prototype.toJSON.apply(this);data.subreddits=this.subreddits.toJSON();return data},isNew:function(){return this.uncreated},name:function(){return this.get("path").split("/").pop()},sync:function(a){var b=Backbone.sync.apply(this,arguments);a=="create"&&b.done(_.bind(function(){this.uncreated=!1},this));return b},addSubreddit:function(a,b){a=r.utils.tup(a);if(a.length==1)this.subreddits.create({name:a[0]},
b);else{var c=this.subreddits,e=c.clone();e.add(_.map(a,function(a){return{name:a}}));this.subreddits=e;this.save(null,b);this.subreddits=c}},removeSubreddit:function(a,b){this.subreddits.getByName(a).destroy(b)},_copyOp:function(a,b,c){var e=new $.Deferred;Backbone.ajax({type:"POST",url:"/api/multi/"+a,data:{from:this.get("path"),to:b.pathByName(c)},success:_.bind(function(c){a=="rename"&&this.trigger("destroy",this,this.collection);c=r.multi.multis.reify(c);b.add(c);e.resolve(c)},this),error:_.bind(e.reject,
e)});return e},copyTo:function(a,b){return this._copyOp("copy",a,b)},renameTo:function(a,b){return this._copyOp("rename",a,b)},getSubredditNames:function(){return this.subreddits.pluck("name")}});r.multi.MyMultiCollection=Backbone.Collection.extend({url:"/api/multi/mine",model:r.multi.MultiReddit,comparator:function(a){return a.get("path").toLowerCase()},parse:function(a){return _.map(a,function(a){return r.multi.multis.reify(a)})},pathByName:function(a){return"/user/"+r.config.logged+"/m/"+a}});
r.multi.GlobalMultiCache=Backbone.Collection.extend({model:r.multi.MultiReddit,touch:function(a){var b=this.get(a);b||(b=new r.multi.MultiReddit({path:a}),this.add(b));return b},reify:function(a){var a=r.multi.MultiReddit.prototype.parse(a),b=this.touch(a.path);b.set(a);return b}});
r.multi.MultiSubredditItem=Backbone.View.extend({tagName:"li",template:_.template('<a href="/r/<%- sr_name %>">/r/<%- sr_name %></a><button class="remove-sr">x</button>'),events:{"click .remove-sr":"removeSubreddit"},render:function(){this.$el.append(this.template({sr_name:this.model.get("name")}));if(r.config.logged)this.bubble=new r.multi.MultiSubscribeBubble({parent:this.$el,group:this.options.bubbleGroup,srName:this.model.get("name")});return this},remove:function(){this.bubble&&this.bubble.remove();
Backbone.View.prototype.remove.apply(this)},removeSubreddit:function(){this.options.multi.removeSubreddit(this.model.get("name"))}});
r.multi.MultiDetails=Backbone.View.extend({events:{"submit .add-sr":"addSubreddit",'change [name="visibility"]':"setVisibility","click .show-copy":"showCopyMulti","click .show-rename":"showRenameMulti","click .edit-description":"editDescription","submit .description":"saveDescription","confirm .delete":"deleteMulti"},initialize:function(){this.listenTo(this.model,"change",this.render);this.listenTo(this.model.description,"change",this.render);this.listenTo(this.model.subreddits,"add",this.addOne);
this.listenTo(this.model.subreddits,"remove",this.removeOne);this.listenTo(this.model.subreddits,"sort",this.resort);this.listenTo(this.model.subreddits,"add remove reset",this.render);new r.ui.ConfirmButton({el:this.$("button.delete")});this.listenTo(this.model.subreddits,"add remove",function(){r.ui.showWorkingDeferred(this.$el,r.ui.refreshListing())});this.model.on("request",function(a,b){r.ui.showWorkingDeferred(this.$el,b)},this);this.bubbleGroup={};this.addBubble=new r.multi.MultiAddNoticeBubble({parent:this.$(".add-sr .sr-name"),
trackHover:!1});this.itemViews={};this.$(".subreddits").empty();this.model.subreddits.each(this.addOne,this)},initRecommendations:function(a){var b=new r.recommend.RecommendationList;this.recsView=new r.recommend.RecommendationsView({collection:b,el:a});this.model.subreddits.isEmpty()||b.fetchForSrs(this.model.getSubredditNames());this.listenTo(this.model.subreddits,"add remove reset",function(){var a=this.model.getSubredditNames();b.fetchForSrs(a)});this.recsView.bind("recs:select",function(a){this.model.addSubreddit(a.srName)},
this)},render:function(){var a=this.model.get("can_edit");a&&(this.model.subreddits.isEmpty()?this.addBubble.show():this.addBubble.hide());this.$el.toggleClass("readonly",!a);this.$el.toggleClass("public",this.model.get("visibility")=="public");this.model.description.has("body_html")&&this.$(".description .usertext-body").html(this.model.description.get("body_html"));this.$(".count").text(this.model.subreddits.length);return this},addOne:function(a){var b=new r.multi.MultiSubredditItem({model:a,multi:this.model,
bubbleGroup:this.bubbleGroup});this.itemViews[a.id]=b;this.$(".subreddits").append(b.render().$el)},resort:function(){this.model.subreddits.each(function(a){this.itemViews[a.id].$el.appendTo(this.$(".subreddits"))},this)},removeOne:function(a){this.itemViews[a.id].remove();delete this.itemViews[a.id]},addSubreddit:function(a){a.preventDefault();var a=this.$(".add-sr .sr-name"),b=a.val(),b=_.compact(b.split(/[\/+,\s]+(?:r\/)?/));b.length&&(a.val(""),this.$(".add-error").css("visibility","hidden"),
this.model.addSubreddit(b,{wait:!0,success:_.bind(function(){this.$(".add-error").hide()},this),error:_.bind(function(a,b){var d=JSON.parse(b.responseText);this.$(".add-error").text(d.explanation).css("visibility","visible").show()},this)}))},setVisibility:function(){this.model.save({visibility:this.$('[name="visibility"]:checked').val()})},showCopyMulti:function(){this.$("form.rename-multi").hide();var a=this.$("form.copy-multi");a.show().find(".multi-name").val(this.model.name()).select().focus();
if(!this.copyForm)this.copyForm=new r.multi.MultiCopyForm({el:a,navOnCreate:!0,sourceMulti:this.model})},showRenameMulti:function(){this.$("form.copy-multi").hide();var a=this.$("form.rename-multi");a.show().find(".multi-name").val(this.model.name()).select().focus();if(!this.renameForm)this.renameForm=new r.multi.MultiRenameForm({el:a,navOnCreate:!0,sourceMulti:this.model})},deleteMulti:function(){this.model.destroy({success:function(){window.location="/"}})},editDescription:function(){show_edit_usertext(this.$el)},
saveDescription:function(a){a.preventDefault();this.model.description.save({body_md:this.$(".description textarea").val()},{success:_.bind(function(){hide_edit_usertext(this.$el)},this)})},focusAdd:function(){this.$(".add-sr .sr-name").focus()}});
r.multi.MultiAddNoticeBubble=r.ui.Bubble.extend({className:"multi-add-notice hover-bubble anchor-right",template:_.template("<h3><%- awesomeness_goes_here %></h3><p><%- add_multi_sr %></p>"),render:function(){this.$el.html(this.template({awesomeness_goes_here:r._("awesomeness goes here"),add_multi_sr:r._("add a subreddit to your multi.")}))}});
r.multi.SubscribeButton=Backbone.View.extend({events:{mouseenter:"createBubble"},createBubble:function(){if(!this.bubble){this.bubble=new r.multi.MultiSubscribeBubble({parent:this.$el,group:this.options.bubbleGroup,srName:String(this.$el.data("sr_name"))});var a=this.$el.data("bubble_class");a&&(this.bubble.$el.removeClass("anchor-right"),this.bubble.$el.addClass(a));this.bubble.queueShow()}}});
r.multi.MultiSubscribeBubble=r.ui.Bubble.extend({className:"multi-selector hover-bubble anchor-right",template:_.template('<div class="title"><strong><%- title %></strong><a class="sr" href="/r/<%- sr_name %>">/r/<%- sr_name %></a></div><div class="throbber"></div>'),itemTemplate:_.template('<label><input class="add-to-multi" type="checkbox" data-path="<%- path %>" <%- checked %>><%- name %><a href="<%- path %>" target="_blank" title="<%- open_multi %>">&rsaquo;</a></label>'),itemCreateTemplate:_.template('<label><form class="create-multi"><input type="text" class="multi-name" placeholder="<%- create_msg %>"><div class="error create-multi-error"></div></form></label>'),
events:{"click .add-to-multi":"toggleSubscribed"},initialize:function(){this.listenTo(this,"show",this.load);this.listenTo(r.multi.mine,"reset add",_.debounce(this.render,100));r.ui.Bubble.prototype.initialize.apply(this)},load:function(){r.ui.showWorkingDeferred(this.$el,r.multi.mine.fetch())},render:function(){this.$el.html(this.template({title:r._("categorize"),sr_name:this.options.srName}));var a=$('<div class="multi-list">');r.multi.mine.chain().sortBy(function(a){return a.subreddits.getByName(this.options.srName)},
this).each(function(b){a.append(this.itemTemplate({name:b.get("name"),path:b.get("path"),checked:b.subreddits.getByName(this.options.srName)?"checked":"",open_multi:r._("open this multi")}))},this);a.append(this.itemCreateTemplate({create_msg:r._("create a new multi")}));this.$el.append(a);this.createForm=new r.multi.MultiCreateForm({el:this.$("form.create-multi")})},toggleSubscribed:function(a){var a=$(a.target),b=r.multi.mine.get(a.data("path"));a.is(":checked")?b.addSubreddit(this.options.srName):
b.removeSubreddit(this.options.srName)}});
r.multi.MultiCreateForm=Backbone.View.extend({events:{submit:"createMulti"},createMulti:function(a){a.preventDefault();a=this.$("input.multi-name").val();if(a=$.trim(a))a=this._createMulti(a),a.done(_.bind(function(a){this.trigger("create",a);if(this.options.navOnCreate)window.location=a.get("path")+"#created"},this)).fail(_.bind(function(a){this.showError(JSON.parse(a.responseText).explanation)},this)),r.ui.showWorkingDeferred(this.$el,a)},_createMulti:function(a){var a=new r.multi.MultiReddit({path:r.multi.mine.pathByName(a)},
{isNew:!0}),b=new $.Deferred;r.multi.mine.create(a,{wait:!0,success:_.bind(b.resolve,b),error:function(a,e){b.reject(e)}});return b},showError:function(a){this.$(".error").text(_.unescape(a)).show()},focus:function(){this.$(".multi-name").focus()}});r.multi.MultiCopyForm=r.multi.MultiCreateForm.extend({_createMulti:function(a){return this.options.sourceMulti.copyTo(r.multi.mine,a)}});
r.multi.MultiRenameForm=r.multi.MultiCopyForm.extend({_createMulti:function(a){return this.options.sourceMulti.renameTo(r.multi.mine,a)}});
r.multi.ListingChooser=Backbone.View.extend({events:{"click .create button":"createClick","click .grippy":"toggleCollapsed"},initialize:function(){this.$el.addClass("initialized");store.safeGet("ui.collapse.listingchooser")==!0&&this.toggleCollapsed(!0);store.safeSet("ui.collapse.listingchooser");var a=this.$(".contents").height(),b=$("body").height();a>b&&$("body").css("padding-bottom",a-b+100)},createClick:function(a){if(!this.$(".create").is(".expanded"))a.preventDefault(),this.$(".create").addClass("expanded"),
this.createForm=new r.multi.MultiCreateForm({el:this.$(".create form"),navOnCreate:!0}),this.createForm.focus()},toggleCollapsed:function(a){$("body").toggleClass("listing-chooser-collapsed",a);Backbone.ajax({type:"POST",url:"/api/set_left_bar_collapsed.json",data:{collapsed:$("body").is(".listing-chooser-collapsed")}})}});r.recommend={init:function(){$(".explore-item").each(function(a,b){new r.recommend.ExploreItem({el:b})})}};r.recommend.Recommendation=Backbone.Model.extend();
r.recommend.RecommendationList=Backbone.Collection.extend({model:r.recommend.Recommendation,srNames:[],dismissed:[],fetchForSrs:function(a){a.length?(this.srNames=a,this.fetchRecs()):(this.srNames=[],this.reset([]))},fetchNewRecs:function(){var a=this.pluck("sr_name");this.dismissed=_.union(this.dismissed,a);this.fetchRecs()},fetchRecs:function(){this.fetch({url:"/api/recommend/sr/"+this.srNames.join(","),data:{omit:this.dismissed.join(",")},reset:!0,error:_.bind(function(){this.reset([])},this)})},
clearHistory:function(){this.dismissed=[]}});
r.recommend.RecommendationsView=Backbone.View.extend({collection:r.recommend.RecommendationList,tagName:"div",itemTemplate:_.template('<li class="rec-item"><a href="/r/<%- sr_name %>" title="<%- sr_name %>" target="_blank">/r/<%- sr_name %></a><button class="add add-rec" data-srname="<%- sr_name %>"></button></li>'),initialize:function(){this.listenTo(this.collection,"add remove reset",this.render)},events:{"click .add-rec":"onAddClick","click .more":"showMore","click .reset":"resetRecommendations"},
render:function(){this.$(".recommendations").empty();if(this.collection.models.length>0){this.$(".recs").show();this.$(".endoflist").hide();var a=this;this.collection.each(function(b){this.$(".recommendations").append(a.itemTemplate({sr_name:b.get("sr_name")}))},this);this.$el.css({opacity:1})}else this.collection.dismissed.length>0?(this.$(".recs").hide(),this.$(".endoflist").show()):this.$el.css({opacity:0});return this},resetRecommendations:function(){this.collection.clearHistory();this.collection.fetchRecs()},
onAddClick:function(a){this.trigger("recs:select",{srName:$(a.target).data("srname")})},showMore:function(){this.collection.fetchNewRecs()}});
r.recommend.ExploreItem=Backbone.View.extend({events:{"click .explore-feedback-dismiss":"dismissSubreddit","click a":"recordClick"},dismissSubreddit:function(a){var b=$(a.target).closest(".explore-item"),a=b.data("sr_name"),b=b.data("src");r.ajax({type:"POST",url:"/api/recommend/feedback",data:{type:"dis",srnames:a,src:b,page:"explore"}});this.$(".explore-feedback-dismiss").css({"font-weight":"bold"});$(this.el).fadeOut("fast")},recordClick:function(a){var b=$(a.target).closest(".explore-item"),a=
b.data("sr_name"),b=b.data("src");r.ajax({type:"POST",url:"/api/recommend/feedback",data:{type:"clk",srnames:a,src:b,page:"explore"}})}});r.saved={};r.saved.SaveCategories=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"category"}),url:"/api/saved_categories.json",fetchOnce:function(){if(!this._fetched)this._fetched=this.fetch();return this._fetched},comparator:function(a){return a.get("category")},parse:function(a){return a.categories}});
r.saved.SaveDialog=r.ui.Bubble.extend({tagName:"form",className:"hover-bubble anchor-left save-selector",confirmTemplate:_.template('<label for="savedcategory"><%- label %></label><span class="throbber"></span><select><option value=""><%- placeholder %></option></select><input maxlength="20" class="savedcategory"  name="savedcategory" placeholder="<%- textplaceholder %>"><input type="submit" value="<%- save %>"><div class="error"></div>'),events:{click:"clicked",submit:"save",mouseout:"mouseout",
mouseover:"cancelTimeout","change select":"change"},mouseout:function(){this.$el.find("select, .savedcategory").is(":focus")||this.queueHide()},clicked:function(a){a.stopPropagation()},initialize:function(a){this.options=a;this.options.trackHover=!1;r.ui.Bubble.prototype.initialize.apply(this);r.saved.categories.fetchOnce().then(_.bind(this.show,this));$("body").on("click.savedialog",_.bind(this.hideNow,this))},hideNow:function(){r.ui.Bubble.prototype.hideNow.apply(this);$("body").off("click.savedialog");
this.remove()},error:function(){this.$el.find("select, .savedcategory").attr("disabled",!1);this.$el.removeClass("working");this.$el.find(".error").text(r._("Invalid category name"))},change:function(){var a=this.$el.find(".savedcategory"),b=this.$el.find("option:selected").val();a.val(b).focus()},success:function(){var a=this.$parent.parents(".thing").find(".save-category");a.length&&this.category?(a.text("category: "+this.category),a.attr("href","/user/"+r.config.logged+"/saved/"+this.category),
a.show()):a.hide();r.saved.SaveButton.setSaved(this.$parent);this.category&&(r.saved.categories.add({category:this.category}),r.saved.categories.sort());this.hide()},save:function(a){a.preventDefault();this.category=this.$el.find(".savedcategory").val();this.$el.find("select, .savedcategory").attr("disabled",!0);if(!this.category)return this.success();this.$el.addClass("working");r.ajax({type:"POST",url:"/api/save",data:{id:this.$parent.thing_id(),category:this.category},success:this.success,error:this.error,
context:this})},addCategory:function(a){a=a.get("category");this.$el.find("select").append($("<option>").val(a).text(a))},show:function(){r.ui.Bubble.prototype.show.apply(this);this.$el.find(".savedcategory").focus()},render:function(){this.$el.html(this.confirmTemplate({label:r._("save category"),placeholder:r._("no category"),save:r._("save"),textplaceholder:r._("new category")}));r.saved.categories.each(this.addCategory,this);this.$el.find("select").first().prop("selected",!0)}});
r.saved.SaveButton={request:function(a,b,c){r.ajax({type:"POST",url:"/api/"+b,data:{id:a.thing_id()},success:_.bind(c,this,a)})},toggleSaved:function(a){this.isSaved(a)?this.unsave(a):this.save(a)},unsave:function(a){this.request(a,"unsave",this.setUnsaved)},save:function(a){this.request(a,"save",this.setSaved);r.config.gold&&new r.saved.SaveDialog({parent:a,group:r.saved.SaveButton})},isSaved:function(a){return a.thing().hasClass("saved")},setUnsaved:function(a){a.parents(".thing").find(".save-category").hide();
a.text(r._("save"));a.thing().removeClass("saved")},setSaved:function(a){a.text(r._("unsave"));a.thing().addClass("saved")}};r.saved.categories=new r.saved.SaveCategories;r.saved.init=function(){$("body").on("click",".save-button a",function(a){a.stopPropagation();a.preventDefault();r.saved.SaveButton.toggleSaved($(this))})};
r.permissions=_.extend(r.permissions||{},{moderator:{wiki:{description:r.N_("manage the wiki and access to the wiki"),title:r.N_("wiki")},access:{description:r.N_("manage the lists of contributors and banned users"),title:r.N_("access")},mail:{description:r.N_("read and reply to moderator mail"),title:r.N_("mail")},config:{description:r.N_("edit settings, sidebar, css, and images"),title:r.N_("config")},posts:{description:r.N_("use the approve, remove, spam, distinguish, and nsfw buttons"),title:r.N_("posts")},
flair:{description:r.N_("manage user flair, link flair, and flair templates"),title:r.N_("flair")}},moderator_invite:{wiki:{description:r.N_("manage the wiki and access to the wiki"),title:r.N_("wiki")},access:{description:r.N_("manage the lists of contributors and banned users"),title:r.N_("access")},mail:{description:r.N_("read and reply to moderator mail"),title:r.N_("mail")},config:{description:r.N_("edit settings, sidebar, css, and images"),title:r.N_("config")},posts:{description:r.N_("use the approve, remove, spam, distinguish, and nsfw buttons"),
title:r.N_("posts")},flair:{description:r.N_("manage user flair, link flair, and flair templates"),title:r.N_("flair")}}});
(function(a){a.fn.lazyload=function(b){var c={threshold:0,failurelimit:0,event:"scroll",effect:"show",container:window};b&&a.extend(c,b);var e=this;"scroll"==c.event&&a(c.container).bind("scroll",function(){var b=0;e.each(function(){if(!a.abovethetop(this,c)&&!a.leftofbegin(this,c))if(!a.belowthefold(this,c)&&!a.rightoffold(this,c))a(this).trigger("appear");else if(b++>c.failurelimit)return!1});var g=a.grep(e,function(a){return!a.loaded});e=a(g)});this.each(function(){var b=this;void 0==a(b).attr("original")&&
a(b).attr("original",a(b).attr("src"));"scroll"!=c.event||void 0==a(b).attr("src")||c.placeholder==a(b).attr("src")||a.abovethetop(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.rightoffold(b,c)?(c.placeholder?a(b).attr("src",c.placeholder):a(b).removeAttr("src"),b.loaded=!1):b.loaded=!0;a(b).one("appear",function(){this.loaded||a("<img />").bind("load",function(){a(b).hide().attr("src",a(b).attr("original"))[c.effect](c.effectspeed);b.loaded=!0}).attr("src",a(b).attr("original"))});"scroll"!=c.event&&
a(b).bind(c.event,function(){b.loaded||a(b).trigger("appear")})});a(c.container).trigger(c.event);return this};a.belowthefold=function(b,c){return(c.container===void 0||c.container===window?a(window).height()+a(window).scrollTop():a(c.container).offset().top+a(c.container).height())<=a(b).offset().top-c.threshold};a.rightoffold=function(b,c){return(c.container===void 0||c.container===window?a(window).width()+a(window).scrollLeft():a(c.container).offset().left+a(c.container).width())<=a(b).offset().left-
c.threshold};a.abovethetop=function(b,c){return(c.container===void 0||c.container===window?a(window).scrollTop():a(c.container).offset().top)>=a(b).offset().top+c.threshold+a(b).height()};a.leftofbegin=function(b,c){return(c.container===void 0||c.container===window?a(window).scrollLeft():a(c.container).offset().left)>=a(b).offset().left+c.threshold+a(b).width()};a.extend(a.expr[":"],{"below-the-fold":"$.belowthefold(a, {threshold : 0, container: window})","above-the-fold":"!$.belowthefold(a, {threshold : 0, container: window})",
"right-of-fold":"$.rightoffold(a, {threshold : 0, container: window})","left-of-fold":"!$.rightoffold(a, {threshold : 0, container: window})"})})(jQuery);(function(a){a.fn.show_toolbar=function(){a(this).show()};a.unsafe_orig=a.unsafe;a.unsafe=function(b){b=a.unsafe_orig(b);typeof b=="string"&&(b=b.replace(/[\s]+/g," ").replace(/> +/g,">").replace(/ +</g,"<"));return b||""}})(jQuery);
$(function(){$(window).scrollTop()==0&&$(window).scrollTop(1);$("#topmenu_toggle").click(function(){$(this).toggleClass("active");$("#top_menu").toggle();return!1});$(document).on("click",".expando-button",function(){$(this).toggleClass("expanded");$(this).thing().find(".expando").toggle();return!1});$(document).on("click",".help-toggle",function(){$(this).toggleClass("expanded");$(this).parent().parent().siblings(".markhelp-parent").toggle();return!1});$(document).on("click",".options_link",function(){$(this).siblings(".options_expando").hasClass("expanded")?
($(this).siblings(".options_expando").removeClass("expanded"),$(this).removeClass("active")):($(".options_expando.expanded").each(function(){$(this).removeClass("expanded")}),$(".options_link.active").each(function(){$(this).removeClass("active")}),$(this).siblings(".options_expando").addClass("expanded"),$(this).addClass("active"));return!1});$(document).on("click",".save-button",function(){$(this).toggle();$(this).siblings(".unsave-button").toggle()});$(document).on("click",".unsave-button",function(){$(this).toggle();
$(this).siblings(".save-button").toggle()});$(document).on("click",".options_expando .collapse-button",function(){$(this).parent().removeClass("expanded");$(this).parent().parent().parent().addClass("collapsed");$(this).parent().siblings(".options_link").removeClass("active")});$(document).on("click",".reply-button, .edit-button",function(){$(this).parent().siblings(".options-link").click()});$(document).on("click",".link",function(a){if(a&&a.target&&$(a.target).hasClass("thing"))return $(this).find(".options_link").click(),
!1});$(document).on("click",".comment.collapsed",function(){$(this).removeClass("collapsed")});$(document).on("click",".message.unread",function(){var a=$(this);read_thing(a);return!1});$(document).on("click","a[href=#]",function(){return!1})});$(function(){var a=edit_usertext;edit_user_text=function(b){$(b).parent().parent().toggleClass("hidden");return a(b)}});
function showcover(){$.request("new_captcha");$(".login-popup:first").fadeIn().find(".popup").css("top",$(window).scrollTop()+75).end().find(".cover").css("height",$(document).height()).end();return!1}function hidecover(a){$(a).parents(".cover-overlay").fadeOut();return!1}function show_edit_usertext(a){var b=a.find(".usertext-edit"),c=a.find(".usertext-body"),e=b.find("div > textarea");c.hide();b.show();a.find(".cancel, .save").show().end().find(".help-toggle").show().end();e.focus()}
function fetch_more(){$("#siteTable").after($("<div class='loading'><img src='"+r.utils.staticURL("reddit_loading.png")+"'/></div>"));var a=document.location,b=a.pathname.split("."),b=b[b.length-1].indexOf("/")==-1?b.slice(0,-1).join("."):a.pathname,a=a.protocol+"//"+a.host+b+".json-compact"+a.search,b=$("#siteTable").find(".thing:last");a+=(document.location.search?"&":"?")+"after="+b.thing_id();b.find(".rank").length&&parseInt(b.find(".rank").html());$.getJSON(a,function(a){$.insert_things(a.data,
!0);$(".thing").click(function(){});$("#siteTable").next(".loading").remove();a&&a.data.length==0&&$(window).unbind("scroll")})};
r.i18n.addMessages({"wiki": [null, "uici"], "full permissions": [null, "l\u00e0n-chead"], "invalid cvc": [null, "cvc m\u00ec-dhligheach"], "missing city": [null, "tha baile a dh\u00ecth"], "manage the wiki and access to the wiki": [null, "sti\u00f9irich an uici is inntrigeadh gun uici"], "an error occurred (status: %(status)s)": [null, "thachair mearachd (staid: %(status)s)"], "categorize": [null, "cuir ann an roinn-se\u00f2rsa"], "yes": [null, "tha"], "add a subreddit to your multi.": [null, "cuir subreddit ris a' mhulti agad."], "awesomeness goes here": [null, "tha m\u00ecorbhaileachd a' dol an-seo"], "open this multi": [null, "fosgail am multi seo"], "no permissions": [null, "gun cheand"], "use the approve, remove, spam, distinguish, and nsfw buttons": [null, "cleachd na putanan airson aonta, toirt air falbh, spama, eadar-dhealachadh is nsfw"], "Looks like you're browsing on a small screen. Would you like to try [reddit's mobile interface](%(url)s)?": [null, "Tha coltas gu bheil sgr\u00ecn bheag agad. A bheil thu airson an [eadar-aghaidh mobile aig reddit](%(url)s) fheuchainn?"], "read and reply to moderator mail": [null, "leugh is freagair post nam modaratair"], "create a new multi": [null, "cruthaich multi \u00f9r"], "invalid expiration date": [null, "tha an ceann-l\u00e0 a dh'fhalbhas an \u00f9ine air m\u00ec-dhligheach"], "access": [null, "inntrigeadh"], "manage the lists of contributors and banned users": [null, "sti\u00f9irich liosta nan com-p\u00e0irtichean is nan cleachdaichean bacte"], "mail": [null, "post"], "save": [null, "s\u00e0bhail"], "are you sure?": [null, "a bheil thu cinnteach?"], "missing address": [null, "tha se\u00f2ladh a dh\u00ecth"], "missing country": [null, "tha d\u00f9thaich a dh\u00ecth"], "edit settings, sidebar, css, and images": [null, "deasaich na roghainnean, am b\u00e0r-taoibh, css agus na dealbhan"], "missing name": [null, "tha ainm a dh\u00ecth"], "invalid credit card number": [null, "tha \u00e0ireamh na cairt-chreidis m\u00ec-dhligheach"], "missing zip code": [null, "tha c\u00f2d-puist a dh\u00ecth"], "no": [null, "chan eil"], "manage user flair, link flair, and flair templates": [null, "sti\u00f9irich flair nan cleachdaichean is ceanglaichean agus teamplaidean flair"], "missing state or province": [null, "tha siorrachd, c\u00f2igeamh no st\u00e0it a dh\u00ecth"], "config": [null, "r\u00e8itich"], "try using our secure login form.": [null, "feuch am foirm againn airson cl\u00e0radh a-steach t\u00e8arainte."], "posts": [null, "puist"], "an error occurred. please try again later! (status: %(status)s)": [null, "thachair mearachd. nach fheuch thu ris a-rithist an ceann greis? (staid: %(status)s)"], "unsave": [null, "d\u00ec-sh\u00e0bhail"], "flair": [null, "flair"]});